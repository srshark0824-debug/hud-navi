<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HUDãƒŠãƒ“ï¼ˆåœ°åå…¥åŠ›ï¼‹æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼å¯¾å¿œï¼‰</title>
<style>
  body {
    background: black;
    color: rgb(0, 255, 13);
    font-family: monospace;
    text-align: center;
    margin-top: 10vh;
  }
  #arrow {
    font-size: 5em;
    transition: transform 0.5s linear;
  }
</style>
</head>
<body>
  <body>
  <h2>HUDãƒŠãƒ“</h2>
  <div id="arrow">â¬†ï¸</div>
  <p id="info">ç›®çš„åœ°ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
  <button id="startBtn">â–¶ï¸ ãƒŠãƒ“é–‹å§‹</button>

<script>
const API_KEY = "AIzaSyDHRitaxXlwj13-dz9zPKpwvhGZorwzgRY";
let destination = null;
let headingOffset = 0;
let arrived = false; // âœ… è¿½åŠ ï¼šåˆ°ç€åˆ¤å®šç”¨ãƒ•ãƒ©ã‚°

// âœ… è·é›¢è¨ˆç®—ï¼ˆ2ç‚¹é–“ã®ç·¯åº¦çµŒåº¦ã‹ã‚‰ãƒ¡ãƒ¼ãƒˆãƒ«å˜ä½ã§è·é›¢ã‚’å‡ºã™ï¼‰
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371e3; // åœ°çƒã®åŠå¾„[m]
  const Ï†1 = lat1 * Math.PI / 180;
  const Ï†2 = lat2 * Math.PI / 180;
  const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
  const Î”Î» = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(Î”Ï† / 2) ** 2 +
            Math.cos(Ï†1) * Math.cos(Ï†2) *
            Math.sin(Î”Î» / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c; // è·é›¢[m]
}

// âœ… æ–¹ä½è§’è¨ˆç®—ï¼ˆæ—¢å­˜ï¼‰
function getBearing(lat1, lon1, lat2, lon2) {
  const toRad = deg => deg * Math.PI / 180;
  const y = Math.sin(toRad(lon2 - lon1)) * Math.cos(toRad(lat2));
  const x = Math.cos(toRad(lat1)) * Math.sin(toRad(lat2)) -
            Math.sin(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.cos(toRad(lon2 - lon1));
  const brng = Math.atan2(y, x);
  return (brng * 180 / Math.PI + 360) % 360;
}

// âœ… ç¾åœ¨åœ°è¿½è·¡
function startNavigation() {
  navigator.geolocation.watchPosition(pos => {
    if (arrived) return; // æ—¢ã«åˆ°ç€ã—ã¦ã„ãŸã‚‰å‡¦ç†ã—ãªã„

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    // --- æ–¹ä½è§’ã¨è·é›¢ã‚’è¨ˆç®— ---
    const bearing = getBearing(lat, lon, destination.lat, destination.lon);
    const distance = getDistance(lat, lon, destination.lat, destination.lon);

    // --- åˆ°ç€åˆ¤å®š ---
    if (distance < 50) { // âœ… 50mä»¥å†…
      arrived = true;
      document.getElementById("info").innerText = "ğŸ‰ ç›®çš„åœ°ã«åˆ°ç€ã—ã¾ã—ãŸï¼";
      document.getElementById("arrow").style.display = "none"; // çŸ¢å°ã‚’æ¶ˆã™
      return;
    }

    // --- é€šå¸¸æ›´æ–° ---
    const correctedBearing = (bearing - headingOffset + 360) % 360;
    document.getElementById("arrow").style.transform = `rotate(${correctedBearing}deg)`;
    document.getElementById("info").innerText =
      `è·é›¢ï¼šç´„${distance.toFixed(1)}m\næ–¹ä½ï¼š${bearing.toFixed(1)}Â°\nè£œæ­£ï¼š${headingOffset.toFixed(1)}Â°`;
  }, err => {
    document.getElementById("info").innerText = "ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚";
  }, { enableHighAccuracy: true });

  
// âœ… ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³è¨­å®š
document.getElementById("startBtn").addEventListener("click", async () => {
  await enableOrientation();
  askDestination();
  document.getElementById("startBtn").style.display = "none";
});
</script>
</body>
</html>



